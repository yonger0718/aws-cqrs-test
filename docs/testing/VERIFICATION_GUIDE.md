# ğŸ” ç³»çµ±æ¸¬è©¦é©—è­‰æŒ‡å—

## ğŸ“‹ å®Œæ•´æ¸¬è©¦é©—è­‰æµç¨‹

é€™ä»½æŒ‡å—æä¾›äº†ç³»çµ±æ€§çš„æ¸¬è©¦é©—è­‰æ­¥é©Ÿï¼Œç¢ºä¿ AWS CQRS é€šçŸ¥ç³»çµ±çš„å®Œæ•´åŠŸèƒ½æ€§ã€‚

---

## ğŸ¯ æ¨è–¦é©—è­‰é †åº

### **æ­¥é©Ÿ 1: ç’°å¢ƒæº–å‚™èˆ‡ç³»çµ±é©—è­‰**

```bash
# æª¢æŸ¥ç³»çµ±ç’°å¢ƒå’Œå·¥å…·
./scripts/verification/verify_system.sh
```

**é æœŸçµæœï¼š**

- âœ… æ‰€æœ‰å¿…è¦å·¥å…·å·²å®‰è£ï¼ˆDockerã€AWS CLIã€jqã€curlã€Pythonï¼‰
- âœ… Docker æœå‹™æ­£åœ¨é‹è¡Œ
- âœ… å®¹å™¨ç‹€æ…‹å¥åº·
- âœ… è…³æœ¬æœ‰åŸ·è¡Œæ¬Šé™

### **æ­¥é©Ÿ 2: æœå‹™ç‹€æ…‹é‡ç½®**

```bash
# é‡å•Ÿæ‰€æœ‰æœå‹™ï¼ˆå¯é¸ï¼‰
./scripts/restart_services.sh

# ä¿®å¾© API Gateway é…ç½®
./scripts/fix_api_gateway.sh
```

**ç”¨é€”ï¼š**

- ğŸ”„ ç¢ºä¿æ‰€æœ‰æœå‹™ç‹€æ…‹ä¸€è‡´
- ğŸ”§ ä¿®å¾©å¯èƒ½çš„é…ç½®å•é¡Œ
- ğŸš€ ç‚ºæ¸¬è©¦æº–å‚™æœ€ä½³ç’°å¢ƒ

### **æ­¥é©Ÿ 3: åŸºæœ¬åŠŸèƒ½å¥åº·æª¢æŸ¥**

```bash
# å¿«é€Ÿå¥åº·æª¢æŸ¥
./scripts/testing/quick_test.sh
```

**é©—è­‰é …ç›®ï¼š**

- âœ… EKS Handler æœå‹™éŸ¿æ‡‰ (port 8000)
- âœ… LocalStack æœå‹™å¯ç”¨ (port 4566)
- âœ… DynamoDB è¡¨å­˜åœ¨ä¸”å¯è¨ªå•
- âœ… åŸºæœ¬ API ç«¯é»åŠŸèƒ½

### **æ­¥é©Ÿ 4: æŸ¥è©¢åŠŸèƒ½è©³ç´°æ¸¬è©¦**

```bash
# å…¨è‡ªå‹•æŸ¥è©¢æ¸¬è©¦
./scripts/queries/simple_query.sh --all
```

**æ¸¬è©¦è¦†è“‹ï¼š**

- âœ… æœå‹™é€£æ¥æ€§æª¢æŸ¥
- âœ… DynamoDB è¡¨æ•¸æ“šçµ±è¨ˆ
- âœ… ç”¨æˆ¶æŸ¥è©¢ API æ¸¬è©¦
- âœ… è¡ŒéŠ·æ´»å‹•æŸ¥è©¢æ¸¬è©¦
- âœ… éŒ¯èª¤è™•ç†é©—è­‰

### **æ­¥é©Ÿ 5: CQRS å®Œæ•´æµç¨‹é©—è­‰**

```bash
# ç«¯åˆ°ç«¯ CQRS æµç¨‹æ¸¬è©¦
./scripts/testing/test_full_flow.sh
```

**CQRS æµç¨‹ï¼š**

1. âœ… æ’å…¥æ¸¬è©¦å‘½ä»¤åˆ° `command-records` è¡¨
2. âœ… DynamoDB Stream è‡ªå‹•è§¸ç™¼
3. âœ… Lambda å‡½æ•¸è™•ç†æ•¸æ“šè½‰æ›
4. âœ… åŒæ­¥åˆ° `notification-records` è¡¨
5. âœ… æŸ¥è©¢æœå‹™è¿”å›æ­£ç¢ºæ•¸æ“š
6. âœ… API Gateway è·¯ç”±åŠŸèƒ½

### **æ­¥é©Ÿ 6: Python å–®å…ƒèˆ‡æ•´åˆæ¸¬è©¦**

```bash
cd query-service

# å–®å…ƒæ¸¬è©¦
pytest tests/test_eks_handler.py -v

# æ•´åˆæ¸¬è©¦
pytest tests/test_integration.py -v

# è¦†è“‹ç‡æ¸¬è©¦ï¼ˆå¯é¸ï¼‰
pytest tests/ --cov=. --cov-report=html
```

**æ¸¬è©¦ç¯„åœï¼š**

- âœ… æ‰€æœ‰ API ç«¯é»åŠŸèƒ½
- âœ… DynamoDB æ•´åˆæ¸¬è©¦
- âœ… éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶
- âœ… æ•ˆèƒ½å’Œä¸€è‡´æ€§é©—è­‰

---

## ğŸ“Š é©—è­‰æˆåŠŸæŒ‡æ¨™

### ğŸŸ¢ ç³»çµ±ç´šæŒ‡æ¨™

| æª¢æŸ¥é …ç›®        | æˆåŠŸæ¨™æº–              | é©—è­‰å‘½ä»¤              |
| --------------- | --------------------- | --------------------- |
| **å®¹å™¨ç‹€æ…‹**    | 2 å€‹å®¹å™¨ Up ç‹€æ…‹      | `docker ps`           |
| **æœå‹™éŸ¿æ‡‰**    | HTTP 200/å¥åº·æª¢æŸ¥é€šé | `curl localhost:8000` |
| **DynamoDB è¡¨** | 2 å€‹è¡¨å­˜åœ¨ä¸”å¯è¨ªå•    | AWS CLI æŸ¥è©¢          |
| **Lambda å‡½æ•¸** | å‡½æ•¸å­˜åœ¨ä¸”å¯åŸ·è¡Œ      | LocalStack API        |

### ğŸŸ¢ åŠŸèƒ½ç´šæŒ‡æ¨™

| æ¸¬è©¦é¡å‹     | æˆåŠŸæ¨™æº–             | æ¸¬è©¦æ™‚é–“ |
| ------------ | -------------------- | -------- |
| **å¿«é€Ÿæ¸¬è©¦** | æ‰€æœ‰æª¢æŸ¥é …ç›®é€šé     | ~30 ç§’   |
| **æŸ¥è©¢æ¸¬è©¦** | API è¿”å›æ­£ç¢ºæ ¼å¼æ•¸æ“š | ~45 ç§’   |
| **æµç¨‹æ¸¬è©¦** | CQRS æ•¸æ“šåŒæ­¥æˆåŠŸ    | ~60 ç§’   |
| **å–®å…ƒæ¸¬è©¦** | 9/9 æ¸¬è©¦é€šé         | ~5 ç§’    |
| **æ•´åˆæ¸¬è©¦** | 8/8 æ¸¬è©¦é€šé         | ~8 ç§’    |

### ğŸŸ¢ æ•¸æ“šç´šæŒ‡æ¨™

```bash
# é æœŸæ•¸æ“šç‹€æ…‹
command-records:      â‰¥ 3 ç­†è¨˜éŒ„
notification-records: â‰¥ 3 ç­†è¨˜éŒ„
æŸ¥è©¢ API éŸ¿æ‡‰:        JSON æ ¼å¼ï¼ŒåŒ…å« successã€countã€items
```

---

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

### âŒ ç’°å¢ƒå•é¡Œ

**ç—‡ç‹€ï¼š** å·¥å…·æœªå®‰è£æˆ–ç‰ˆæœ¬ä¸å°

```bash
# Ubuntu/Debian
sudo apt update && sudo apt install docker.io awscli jq curl python3 python3-pip

# æª¢æŸ¥ç‰ˆæœ¬
docker --version
aws --version
python3 --version
```

### âŒ å®¹å™¨å•é¡Œ

**ç—‡ç‹€ï¼š** å®¹å™¨æœªé‹è¡Œæˆ–ä¸å¥åº·

```bash
# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker ps -a

# æŸ¥çœ‹å®¹å™¨æ—¥èªŒ
docker logs eks-handler
docker logs localstack-query-service

# é‡å•Ÿå•é¡Œå®¹å™¨
docker restart eks-handler
docker restart localstack-query-service
```

### âŒ é€£æ¥å•é¡Œ

**ç—‡ç‹€ï¼š** API ç„¡æ³•è¨ªå•

```bash
# æª¢æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "(8000|4566)"

# æ¸¬è©¦é€£æ¥
curl -v http://localhost:8000/health
curl -v http://localhost:4566/health

# æª¢æŸ¥é˜²ç«ç‰†
sudo ufw status
```

### âŒ æ•¸æ“šå•é¡Œ

**ç—‡ç‹€ï¼š** DynamoDB è¡¨ä¸å­˜åœ¨æˆ–æ•¸æ“šä¸åŒæ­¥

```bash
# é‡æ–°åˆå§‹åŒ–
cd query-service
docker exec -it localstack-query-service /etc/localstack/init/ready.d/setup.sh

# æª¢æŸ¥è¡¨ç‹€æ…‹
aws --endpoint-url=http://localhost:4566 dynamodb list-tables
aws --endpoint-url=http://localhost:4566 dynamodb describe-table --table-name command-records
```

### âŒ Python ä¾è³´å•é¡Œ

**ç—‡ç‹€ï¼š** æ¸¬è©¦æ¨¡çµ„ç„¡æ³•å°å…¥

```bash
cd query-service
pip install -r requirements.txt
pip install -r tests/requirements-test.txt

# æª¢æŸ¥å®‰è£
pip list | grep -E "(pytest|boto3|fastapi)"
```

---

## ğŸ¯ é©—è­‰æª¢æŸ¥æ¸…å–®

### ğŸ” **é€æ­¥é©—è­‰æ¸…å–®**

- [ ] **ç’°å¢ƒé©—è­‰** - `verify_system.sh` é€šé
- [ ] **æœå‹™é‡å•Ÿ** - `restart_services.sh` å®Œæˆ
- [ ] **API ä¿®å¾©** - `fix_api_gateway.sh` æˆåŠŸ
- [ ] **å¥åº·æª¢æŸ¥** - `quick_test.sh` å…¨éƒ¨é …ç›®é€šé
- [ ] **æŸ¥è©¢æ¸¬è©¦** - `simple_query.sh --all` æˆåŠŸ
- [ ] **æµç¨‹æ¸¬è©¦** - `test_full_flow.sh` CQRS åŒæ­¥æˆåŠŸ
- [ ] **å–®å…ƒæ¸¬è©¦** - `pytest test_eks_handler.py` 9/9 é€šé
- [ ] **æ•´åˆæ¸¬è©¦** - `pytest test_integration.py` 8/8 é€šé

### ğŸ‰ **å®Œæˆç‹€æ…‹**

ç•¶æ‰€æœ‰é …ç›®éƒ½å‹¾é¸æ™‚ï¼š

- âœ… æ‚¨çš„ AWS CQRS é€šçŸ¥ç³»çµ±å®Œå…¨æ­£å¸¸é‹è¡Œ
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½ç¶“éé©—è­‰
- âœ… ç³»çµ±æº–å‚™å¥½æ¥å—å¯¦éš›å·¥ä½œè² è¼‰
- âœ… å¯ä»¥é–‹å§‹å¯¦éš›çš„é–‹ç™¼å’Œéƒ¨ç½²å·¥ä½œ

---

## ğŸ“ˆ æ•ˆèƒ½åŸºæº–

### âš¡ åŸ·è¡Œæ™‚é–“åŸºæº–

```bash
ç³»çµ±é©—è­‰:     ~15-30ç§’
å¿«é€Ÿæ¸¬è©¦:     ~30-45ç§’
æŸ¥è©¢æ¸¬è©¦:     ~45-60ç§’
æµç¨‹æ¸¬è©¦:     ~60-90ç§’
Python æ¸¬è©¦:  ~10-15ç§’
ç¸½é©—è­‰æ™‚é–“:   ~3-4åˆ†é˜
```

### ğŸ“Š è³‡æºä½¿ç”¨åŸºæº–

```bash
å®¹å™¨è¨˜æ†¶é«”ä½¿ç”¨: <1GB
CPU ä½¿ç”¨ç‡:     <50%
ç£ç¢Ÿç©ºé–“:       <2GB
ç¶²è·¯å»¶é²:       <100ms (æœ¬åœ°)
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- ğŸš€ [å¿«é€Ÿæ¸¬è©¦æŒ‡å—](./QUICK_TEST_GUIDE.md) - ç°¡åŒ–ç‰ˆæ¸¬è©¦æµç¨‹
- ğŸ“‹ [å®Œæ•´æ¸¬è©¦æŒ‡å—](./TESTING_GUIDE.md) - è©³ç´°æ¸¬è©¦èªªæ˜
- ğŸ”§ [è…³æœ¬å·¥å…·ç´¢å¼•](../../scripts/README.md) - æ‰€æœ‰è…³æœ¬èªªæ˜
- ğŸ¯ [æœ€çµ‚ä½¿ç”¨æŒ‡å—](../guides/FINAL_USAGE_GUIDE.md) - å®Œæ•´ç³»çµ±ä½¿ç”¨

**ç«‹å³é–‹å§‹é©—è­‰æ‚¨çš„ç³»çµ±ï¼š**

```bash
# é–‹å§‹å®Œæ•´é©—è­‰æµç¨‹
./scripts/verification/verify_system.sh
```

> **ğŸ’¡ æç¤ºï¼š** å»ºè­°åœ¨æ–°ç’°å¢ƒæˆ–é‡å¤§æ›´æ”¹å¾ŒåŸ·è¡Œå®Œæ•´é©—è­‰æµç¨‹ï¼Œç¢ºä¿ç³»çµ±ç©©å®šæ€§ã€‚
